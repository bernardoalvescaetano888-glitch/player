<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Player Ultimate Profissional</title>
<style>
:root{
  --accent:#ff6600;
  --fg:#eee;
  --bg-alt:#1a1a1a;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  height:100vh;
  color:var(--fg);
  background: linear-gradient(270deg, #ff6600, #ffcc00, #00ccff, #6600ff);
  background-size: 800% 800%;
  animation: gradientAnimation 20s ease infinite;
  transition: color 0.3s;
}
@keyframes gradientAnimation{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
#sidebar{
  width:260px;
  padding:18px;
  border-right:1px solid rgba(255,255,255,0.2);
  box-sizing:border-box;
  background:rgba(0,0,0,0.5);
  backdrop-filter: blur(6px);
  overflow:auto;
}
#main{
  flex:1;
  padding:18px;
  box-sizing:border-box;
  overflow:auto;
}
h1,h3{margin:0 0 12px 0;color:var(--accent)}
button{
  cursor:pointer;
  padding:8px 12px;
  border-radius:6px;
  border:0;
  background:rgba(0,0,0,0.5);
  color:#fff;
  margin:2px;
  transition:0.3s;
}
button:hover{background:rgba(0,0,0,0.8);}
input[type="file"],input[type="text"],select{
  display:block;
  margin:8px 0;
  padding:6px;
  width:100%;
  box-sizing:border-box;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.3);
  background:rgba(0,0,0,0.3);
  color:#fff;
}
ul{padding-left:0;list-style:none;margin:8px 0;max-height:220px;overflow:auto}
li{
  padding:6px;
  border-radius:6px;
  margin:4px 0;
  background:rgba(0,0,0,0.5);
  display:flex;
  justify-content:space-between;
  align-items:center;
  transition:0.3s;
  cursor:pointer;
}
li.active{background:var(--accent);color:#111;font-weight:bold;}
li:hover{background:rgba(255,255,255,0.1);}
.small{font-size:13px;color:#bbb}
#cover{width:260px;height:260px;object-fit:cover;border-radius:8px;background:#222;margin-bottom:10px;transition:transform 0.3s;}
#cover.pulse{animation:pulseCover 0.5s infinite alternate;}
@keyframes pulseCover{0%{transform:scale(1);}100%{transform:scale(1.05);}}
#controls{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
#visualizer,#dbMeter{width:100%;border-radius:8px;margin-top:8px}
label.range{display:block;margin:6px 0}
.accent{color:var(--accent)}
.muted{color:#ccc;font-size:13px}
.btn-accent{background:var(--accent);border:none;color:#111}
.btn-danger{background:#9b2a2a}
.drag-over{border:2px dashed var(--accent);}
input[type="range"]{cursor:pointer;}
#equalizer-wrapper{display:flex;gap:6px;margin-top:6px;}
.eq-slider{flex:1;}
#searchMusic{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.3);width:100%;margin-bottom:6px;background:rgba(0,0,0,0.3);color:#fff;}
</style>
</head>
<body>

<div id="sidebar">
  <div id="clock" class="muted">Hora: --:--</div>
  <h3 class="accent">Controles Rápidos</h3>
  <div style="margin:8px 0">
    <button onclick="toggleLoop()">Loop: <span id="loopLabel">Off</span></button>
    <button onclick="toggleShuffle()">Shuffle: <span id="shuffleLabel">Off</span></button>
  </div>
  <hr style="border-color:rgba(255,255,255,0.2);margin:12px 0">
  <h3 class="accent">Favoritos</h3>
  <ul id="favoritesList"></ul>
  <h3 class="accent">Histórico</h3>
  <ul id="historyList"></ul>
</div>

<div id="main">
  <h1>Player Ultimate</h1>
  <input id="searchMusic" placeholder="Pesquisar músicas...">
  <img id="cover" src="" alt="Capa (se disponível)">
  <audio id="player" controls style="width:100%;display:block"></audio>

  <div id="controls">
    <button onclick="prevMusic()" class="btn-accent">◀ Anterior</button>
    <button onclick="playPause()">⏯ Play/Pause</button>
    <button onclick="nextMusic()" class="btn-accent">Próxima ▶</button>
    <button id="favBtn" onclick="toggleFavorite()" title="Favoritar">♡ Favorito</button>
    <button onclick="clearPlaylist()" class="btn-danger">Limpar playlist</button>
  </div>

  <div id="progressWrapper" style="max-width:620px;">
    <input type="range" id="progress" min="0" max="100" value="0" style="width:100%">
    <div class="small" id="timeDisplay">00:00 / 00:00</div>
  </div>

  <div style="margin-top:12px;max-width:620px;">
    <label class="range">Volume: <input id="volume" type="range" min="0" max="1" step="0.01" value="1"></label>
  </div>

  <div id="equalizer-wrapper">
    <input type="range" class="eq-slider" id="eqBass" min="-20" max="20" value="0">
    <input type="range" class="eq-slider" id="eqMid" min="-20" max="20" value="0">
    <input type="range" class="eq-slider" id="eqTreble" min="-20" max="20" value="0">
  </div>

  <div id="equalizer" style="max-width:620px;margin-top:6px;">
    <canvas id="visualizer" height="150"></canvas>
    <canvas id="dbMeter" height="20"></canvas>
  </div>

  <hr style="margin:14px 0;border-color:rgba(255,255,255,0.2)">

  <h3 class="accent">Lista de músicas (arraste arquivos ou clique)</h3>
  <input type="file" id="filePicker" multiple accept="audio/*">
  <ul id="musicList" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="dropFiles(event)"></ul>

  <hr style="margin:14px 0;border-color:rgba(255,255,255,0.2)">

  <h3 class="accent">Playlist atual</h3>
  <ul id="playlist"></ul>
  <div class="muted small">Clique em uma música na playlist para tocar ela agora</div>
</div>

<script>
let musicList=[], playlist=[], currentIndex=0, loop=false, shuffle=false;
let favorites=[], history=[];
let audioCtx, analyser, sourceNode, gainNode, bassFilter, midFilter, trebleFilter;

// DOM
const player=document.getElementById("player");
const musicUl=document.getElementById("musicList");
const playlistUl=document.getElementById("playlist");
const favBtn=document.getElementById("favBtn");
const favoritesList=document.getElementById("favoritesList");
const historyList=document.getElementById("historyList");
const progress=document.getElementById("progress");
const timeDisplay=document.getElementById("timeDisplay");
const volume=document.getElementById("volume");
const cover=document.getElementById("cover");
const searchMusic=document.getElementById("searchMusic");
player.volume=1;

// Clock
function updateClock(){
  const d=new Date();
  document.getElementById("clock").textContent=`Hora: ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
}
setInterval(updateClock,1000);
updateClock();

// Playlist
function addMusic(file){const url=URL.createObjectURL(file);musicList.push({name:file.name,url,cover:null});renderMusicList();}
function renderMusicList(){musicUl.innerHTML="";let search=searchMusic.value.toLowerCase();musicList.forEach((m,i)=>{if(m.name.toLowerCase().includes(search)){const li=document.createElement("li");li.textContent=m.name;li.onclick=()=>{addToPlaylist(i)};musicUl.appendChild(li);}});}
function addToPlaylist(index){playlist.push({...musicList[index]});savePlaylist();renderPlaylist();}
function renderPlaylist(){playlistUl.innerHTML="";playlist.forEach((m,i)=>{const li=document.createElement("li");li.textContent=m.name;if(i===currentIndex) li.classList.add("active");li.onclick=()=>{playIndex(i)};playlistUl.appendChild(li);});}
function playIndex(index){
  if(index<0||index>=playlist.length) return;
  currentIndex=index;
  player.src=playlist[currentIndex].url;
  player.play();
  addToHistory(playlist[currentIndex]);
  updateFavButton();
  renderPlaylist();
  cover.classList.add("pulse");
  setTimeout(()=>cover.classList.remove("pulse"),1000);
  if(audioCtx) setupEQ();
}
function playPause(){if(player.paused)player.play();else player.pause();}
function nextMusic(){if(shuffle)currentIndex=Math.floor(Math.random()*playlist.length);else currentIndex++;if(currentIndex>=playlist.length){if(loop)currentIndex=0;else currentIndex=playlist.length-1;}playIndex(currentIndex);}
function prevMusic(){currentIndex--;if(currentIndex<0){if(loop)currentIndex=playlist.length-1;else currentIndex=0;}playIndex(currentIndex);}
function toggleLoop(){loop=!loop;document.getElementById("loopLabel").textContent=loop?"On":"Off";}
function toggleShuffle(){shuffle=!shuffle;document.getElementById("shuffleLabel").textContent=shuffle?"On":"Off";}

// Progress & volume
player.addEventListener("timeupdate",()=>{
  if(player.duration){progress.value=(player.currentTime/player.duration)*100;const c=Math.floor(player.currentTime),d=Math.floor(player.duration);timeDisplay.textContent=`${Math.floor(c/60).toString().padStart(2,'0')}:${(c%60).toString().padStart(2,'0')} / ${Math.floor(d/60).toString().padStart(2,'0')}:${(d%60).toString().padStart(2,'0')}`;}
});
progress.addEventListener("input",()=>{player.currentTime=(progress.value/100)*player.duration;});
volume.addEventListener("input",()=>{player.volume=volume.value;});

// Favorites & history
function toggleFavorite(){const cSong=playlist[currentIndex];const idx=favorites.findIndex(f=>f.url===cSong.url);if(idx>=0){favorites.splice(idx,1);}else{favorites.push(cSong);}renderFavorites();updateFavButton();}
function renderFavorites(){favoritesList.innerHTML="";favorites.forEach(f=>{const li=document.createElement("li");li.textContent=f.name;favoritesList.appendChild(li);});}
function updateFavButton(){const cSong=playlist[currentIndex];favBtn.textContent=favorites.find(f=>f.url===cSong.url)?"❤️ Favorito":"♡ Favorito";}
function addToHistory(song){history.push(song);renderHistory();}
function renderHistory(){historyList.innerHTML="";history.forEach(h=>{const li=document.createElement("li");li.textContent=h.name;historyList.appendChild(li);});}

// File picker & drag-drop
document.getElementById("filePicker").addEventListener("change",e=>{Array.from(e.target.files).forEach(f=>addMusic(f));});
searchMusic.addEventListener("input",renderMusicList);
function dragOver(e){e.preventDefault();musicUl.classList.add("drag-over");}
function dragLeave(e){musicUl.classList.remove("drag-over");}
function dropFiles(e){e.preventDefault();musicUl.classList.remove("drag-over");Array.from(e.dataTransfer.files).forEach(f=>{if(f.type.startsWith("audio/")) addMusic(f);});}

// Playlist storage
function savePlaylist(){localStorage.setItem("savedPlaylist",JSON.stringify(playlist));}
function clearPlaylist(){playlist=[];savePlaylist();renderPlaylist();currentIndex=0;player.src="";}

// AudioContext & visualizer
const canvas=document.getElementById("visualizer");
const ctx=canvas.getContext("2d");
const dbCanvas=document.getElementById("dbMeter");
const dbCtx=dbCanvas.getContext("2d");
canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;
dbCanvas.width=dbCanvas.offsetWidth;dbCanvas.height=dbCanvas.offsetHeight;

function initAudioContext(){
  if(audioCtx) return;
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  sourceNode=audioCtx.createMediaElementSource(player);
  gainNode=audioCtx.createGain();
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=256;

  // EQ
  setupEQ();

  sourceNode.connect(bassFilter);
  bassFilter.connect(midFilter);
  midFilter.connect(trebleFilter);
  trebleFilter.connect(analyser);
  analyser.connect(gainNode);
  gainNode.connect(audioCtx.destination);

  drawVisualizer();
  drawDBMeter();
}

function setupEQ(){
  if(!audioCtx) return;
  bassFilter=audioCtx.createBiquadFilter();bassFilter.type="lowshelf";bassFilter.frequency.value=200;
  midFilter=audioCtx.createBiquadFilter();midFilter.type="peaking";midFilter.frequency.value=1000;midFilter.Q.value=1;
  trebleFilter=audioCtx.createBiquadFilter();trebleFilter.type="highshelf";trebleFilter.frequency.value=5000;

  bassFilter.gain.value=parseFloat(document.getElementById("eqBass").value);
  midFilter.gain.value=parseFloat(document.getElementById("eqMid").value);
  trebleFilter.gain.value=parseFloat(document.getElementById("eqTreble").value);
}

document.getElementById("eqBass").addEventListener("input",()=>{if(bassFilter) bassFilter.gain.value=parseFloat(document.getElementById("eqBass").value);});
document.getElementById("eqMid").addEventListener("input",()=>{if(midFilter) midFilter.gain.value=parseFloat(document.getElementById("eqMid").value);});
document.getElementById("eqTreble").addEventListener("input",()=>{if(trebleFilter) trebleFilter.gain.value=parseFloat(document.getElementById("eqTreble").value);});

player.addEventListener("play",()=>{initAudioContext();});

// Visualizer
function drawVisualizer(){
  requestAnimationFrame(drawVisualizer);
  if(!analyser) return;
  const bufferLength=analyser.frequencyBinCount;
  const dataArray=new Uint8Array(bufferLength);
  analyser.getByteFrequencyData(dataArray);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const barWidth=canvas.width/bufferLength;
  for(let i=0;i<bufferLength;i++){
    const barHeight=dataArray[i];
    const gradient=ctx.createLinearGradient(0,canvas.height-barHeight,0,canvas.height);
    gradient.addColorStop(0,"#ff6600");
    gradient.addColorStop(0.5,"#ffcc00");
    gradient.addColorStop(1,"#00ccff");
    ctx.fillStyle=gradient;
    ctx.fillRect(i*barWidth,canvas.height-barHeight,barWidth,barHeight);
  }
}

// Decibel Meter
function drawDBMeter(){
  requestAnimationFrame(drawDBMeter);
  if(!analyser) return;
  const bufferLength=analyser.frequencyBinCount;
  const dataArray=new Uint8Array(bufferLength);
  analyser.getByteFrequencyData(dataArray);
  let sum=0;for(let i=0;i<bufferLength;i++) sum+=dataArray[i]**2;
  let rms=Math.sqrt(sum/bufferLength);
  dbCtx.clearRect(0,0,dbCanvas.width,dbCanvas.height);
  const dbWidth=(rms/255)*dbCanvas.width;
  const gradient=dbCtx.createLinearGradient(0,0,dbCanvas.width,0);
  gradient.addColorStop(0,"#ff0000");
  gradient.addColorStop(0.5,"#ffcc00");
  gradient.addColorStop(1,"#00ff00");
  dbCtx.fillStyle=gradient;
  dbCtx.fillRect(0,0,dbWidth,dbCanvas.height);
}

// Hotkeys
document.addEventListener("keydown",(e)=>{
  if(e.code==="Space"){e.preventDefault();playPause();}
  else if(e.code==="ArrowRight") nextMusic();
  else if(e.code==="ArrowLeft") prevMusic();
  else if(e.code==="KeyM") player.muted=!player.muted;
});

// Render playlist salva
if(localStorage.getItem("savedPlaylist")){playlist=JSON.parse(localStorage.getItem("savedPlaylist"));}
renderPlaylist();
renderMusicList();
</script>

</body>
</html>
